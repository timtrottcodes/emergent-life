<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Emergent Life - Game of Life</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    canvas {
      border: 1px solid #333;
      display: block;
      margin: 0 auto;
    }
    #controls {
      margin-top: 20px;
    }
  </style>
</head>
<body class="bg-light">

<div class="container py-4">
  <h1 class="text-center mb-4">Emergent Life</h1>

  <!-- Explanation Section -->
  <div class="card mb-4">
    <div class="card-body">
      <h4 class="card-title">What is Conway's Game of Life?</h4>
      <p>
        The Game of Life is a cellular automaton devised by mathematician John Conway. 
        It consists of a grid of cells that can be alive or dead. Each generation evolves based on simple rules:
      </p>
      <ul>
        <li>A live cell with fewer than 2 neighbors dies (underpopulation).</li>
        <li>A live cell with 2 or 3 neighbors lives on (survival).</li>
        <li>A live cell with more than 3 neighbors dies (overpopulation).</li>
        <li>A dead cell with exactly 3 neighbors becomes alive (reproduction).</li>
      </ul>
      <p>Despite its simplicity, complex and beautiful patterns emerge from these rules.</p>
    </div>
  </div>

  <!-- Controls -->
  <div id="controls" class="text-center">
    <button id="startBtn" class="btn btn-success m-1">Start</button>
    <button id="resetBtn" class="btn btn-danger m-1">Reset</button>
    <button id="randomBtn" class="btn btn-primary m-1">Randomize</button>
    
    <div class="row mt-3">
      <div class="col-md-6">
        <label for="speedRange" class="form-label">Speed (ms per generation)</label>
        <input type="range" class="form-range" id="speedRange" min="50" max="1000" step="50" value="300">
      </div>
      <div class="col-md-6">
        <label for="gridSizeSelect" class="form-label">Grid Size</label>
        <select id="gridSizeSelect" class="form-select">
          <option value="20">20 x 20</option>
          <option value="40" selected>40 x 40</option>
          <option value="60">60 x 60</option>
          <option value="80">80 x 80</option>
        </select>
      </div>
    </div>

    <h5 class="mt-3">Turn: <span id="turnCounter">0</span></h5>
  </div>

  <!-- Canvas -->
  <div class="mt-4 text-center">
    <canvas id="gameCanvas" width="600" height="600"></canvas>
  </div>
</div>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  let gridSize = 40;
  let cellSize = canvas.width / gridSize;
  let grid = createGrid(gridSize);
  let running = false;
  let speed = 300;
  let intervalId;
  let turn = 0;

  // Controls
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const randomBtn = document.getElementById('randomBtn');
  const speedRange = document.getElementById('speedRange');
  const gridSizeSelect = document.getElementById('gridSizeSelect');
  const turnCounter = document.getElementById('turnCounter');

  // Initialize
  drawGrid();

  // Event Listeners
  startBtn.addEventListener('click', () => {
    running = !running;
    startBtn.textContent = running ? "Pause" : "Start";
    if (running) {
      run();
    } else {
      clearInterval(intervalId);
    }
  });

  resetBtn.addEventListener('click', () => {
    clearInterval(intervalId);
    running = false;
    startBtn.textContent = "Start";
    grid = createGrid(gridSize);
    turn = 0;
    updateTurn();
    drawGrid();
  });

  randomBtn.addEventListener('click', () => {
    grid = createGrid(gridSize, true);
    turn = 0;
    updateTurn();
    drawGrid();
  });

  speedRange.addEventListener('input', e => {
    speed = e.target.value;
    if (running) {
      clearInterval(intervalId);
      run();
    }
  });

  gridSizeSelect.addEventListener('change', e => {
    gridSize = parseInt(e.target.value);
    cellSize = canvas.width / gridSize;
    grid = createGrid(gridSize);
    turn = 0;
    updateTurn();
    drawGrid();
  });

  // Allow toggling cells by clicking
  canvas.addEventListener('click', e => {
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) / cellSize);
    const y = Math.floor((e.clientY - rect.top) / cellSize);
    grid[y][x] = grid[y][x] ? 0 : 1;
    drawGrid();
  });

  // Functions
  function createGrid(size, randomize = false) {
    return Array.from({ length: size }, () =>
      Array.from({ length: size }, () => randomize ? Math.round(Math.random()) : 0)
    );
  }

  function drawGrid() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "#ccc";
    for (let y = 0; y < gridSize; y++) {
      for (let x = 0; x < gridSize; x++) {
        ctx.beginPath();
        ctx.rect(x * cellSize, y * cellSize, cellSize, cellSize);
        ctx.fillStyle = grid[y][x] ? "#000" : "#fff";
        ctx.fill();
        ctx.stroke();
      }
    }
  }

  function nextGeneration() {
    const newGrid = createGrid(gridSize);
    for (let y = 0; y < gridSize; y++) {
      for (let x = 0; x < gridSize; x++) {
        const neighbors = countNeighbors(x, y);
        if (grid[y][x] === 1) {
          newGrid[y][x] = (neighbors === 2 || neighbors === 3) ? 1 : 0;
        } else {
          newGrid[y][x] = (neighbors === 3) ? 1 : 0;
        }
      }
    }
    grid = newGrid;
    turn++;
    updateTurn();
    drawGrid();
  }

  function countNeighbors(x, y) {
    let count = 0;
    for (let i = -1; i <= 1; i++) {
      for (let j = -1; j <= 1; j++) {
        if (i === 0 && j === 0) continue;
        const nx = x + j;
        const ny = y + i;
        if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
          count += grid[ny][nx];
        }
      }
    }
    return count;
  }

  function run() {
    intervalId = setInterval(nextGeneration, speed);
  }

  function updateTurn() {
    turnCounter.textContent = turn;
  }
</script>

</body>
</html>
